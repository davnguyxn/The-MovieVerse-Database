<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Favorite Movies & Watchlists</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="../js/movie-details.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta property="og:title" content="The MovieVerse - Your Ultimate Movie Guide" />
    <meta name="description" content="Explore The MovieVerse to discover and learn about your favorite movies, directors, actors, and more.">
    <link rel="icon" type="image/x-icon" href="../../images/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
    <meta name="theme-color" content="#7378c5">
    <script src="../js/settings.js"></script>
    <link rel="manifest" href="../../manifest.json">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CQKJ67FXZ4"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-CQKJ67FXZ4');
    </script>
    <style>
        .watchlist-controls {
            position: absolute;
            top: 10px;
            display: flex;
            align-items: start;
            gap: 5px;
        }

        .watchlist-controls button {
            background: none;
            border: none;
            color: #ff8623;
            cursor: pointer;
            height: 20px;
            width: 20px;
            margin-right: 8px;
            font-size: 18px;
        }

        #create-watchlist-modal .modal-content {
            min-width: 400px;
            margin-top: 0;
        }

        #edit-watchlist-modal .modal-content {
            min-width: 400px;
            margin-top: 0;
        }

        #delete-watchlist-modal .modal-content {
            min-width: 400px;
            margin-top: 0;
        }

        .watchlist.pinned .watchlist-controls #pin-btn {
            color: #7378c5;
        }

        .watchlist-controls button:hover {
            color: #7378c5;
        }

        .watchlist-controls button:first-child {
            order: -1;
        }

        .watchlist {
            position: relative;
            padding-top: 30px;
        }

        .watchlist.pinned {
            border: 2px solid yellow;
        }

        .watchlist-buttons-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-left: 0;
            margin-top: 15px;
        }

        #local-time {
            transform: translateX(12%);
            padding: 10px;
            border-radius: 10px;
            z-index: 10;
        }

        @media (max-width: 1200px) {
            #local-time {
                display: none;
            }
        }

        #button {
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        #how-to-use {
            text-align: center;
            margin-top: 20px;
            margin-bottom: 60px;
        }

        #how-to-use-btn {
            background-color: #7378c5;
            color: white;
            border-radius: 8px;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font: inherit;
            cursor: pointer;
            border: none;
        }

        #how-to-use-btn:hover {
            background-color: #ff8623;
        }

        #how-to-use-section {
            max-width: 400px;
            margin: 20px auto;
            padding: 15px;
            background-color: #7378c5;
            color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: none;
            transition: height 0.5s ease-in-out;
            margin-bottom: 240px;
        }
    </style>
</head>

<body class="movie-details-body">
<header style="margin-bottom: -30px; padding-top: 19px">
    <div id="header-title">
        <a href="../../index.html" style="text-decoration: none; color: inherit; cursor: pointer" title="Click to go back to the home page">
            <h1 id="my-heading" style="margin-bottom: -10px">
                The Mo<span class="highlight">vieV</span>erse
            </h1>
        </a>
    </div>

    <div id="local-time" style="cursor: pointer" title="Click to view more of your stats!">
        <p id="stats-label" class="clock" style="font-size: 16px"></p>
        <h1 id="stats-display" class="clock"></h1>
    </div>

    <button class="back-btn" onclick="window.location.href='../../index.html'">Home</button>
    <button class="about" onclick="window.location.href='about.html'">About</button>
    <button class="favorites-btn" onclick="window.location.href='favorites.html'" title="Go to your favorites list">Favorites</button>

    <button id="googleSignInBtn" class="nav-btn" onclick="handleSignInOut()" title="Sign In/Out">
        <span id="signInOutText">Sign In</span>
        <i class="fas fa-sign-in-alt" id="signInIcon"></i>
        <i class="fas fa-sign-out-alt" id="signOutIcon" style="display: none;"></i>
    </button>

    <button id="profileBtn" class="nav-btn" onclick="window.location.href='user-profile.html'" title="Go to your profile">
        <span id="profileText">Profile</span>
        <i class="fas fa-user" id="profileIcon"></i>
    </button>

    <form id="form">
        <input
                type="text"
                id="search"
                placeholder="Search For Anything..."
                class="search"
        />
        <button type="button" id="button-search" onclick="handleSearch()">Search</button>
    </form>
</header>

<div class="watchlist-buttons-container">
    <button id="create-watchlist-btn">Create a Watch List</button>
    <button id="edit-watchlist-btn">Edit a Watch List</button>
    <button id="delete-watchlist-btn">Delete Watch Lists</button>
</div>

<div id="create-watchlist-modal" class="modal">
    <div class="modal-content">
        <span class="close-button" title="Close this modal" onclick="closeModal('create-watchlist-modal')">&times;</span>
        <h2>Create a Watch List</h2>
        <form id="create-watchlist-form">
            <label>Name:</label>
            <input type="text" id="new-watchlist-name" placeholder="Watchlist's Name" style="font: inherit" required>
            <div style="height: 20px"></div>
            <label>Description:</label>
            <textarea placeholder="Watchlist Description" id="new-watchlist-description" style="font: inherit"></textarea>
            <button type="submit" id="button" style="display: block; margin-left: auto; color: white; margin-right: auto;">Create</button>
        </form>
    </div>
</div>

<div id="edit-watchlist-modal" class="modal">
    <div class="modal-content">
        <span class="close-button" title="Close this modal" onclick="closeModal('edit-watchlist-modal')">&times;</span>
        <h2>Edit a Watch List</h2>
        <form id="edit-watchlist-form">
            <!-- Dynamically populate this form based on user selection -->
        </form>
    </div>
</div>

<div id="delete-watchlist-modal" class="modal">
    <div class="modal-content">
        <span class="close-button" title="Close this modal" onclick="closeModal('delete-watchlist-modal')">&times;</span>
        <h2>Delete Watch Lists</h2>
        <label>Select watch lists to delete:</label>
        <form id="delete-watchlist-form">
            <!-- Dynamically populate this form based on user selection -->
        </form>
    </div>
</div>

<div id="watchlists-display-section">
    <!-- Dynamically populated watch lists will go here -->
</div>

<main id="favorites-main" style="margin-top: 75px; text-align: center"></main>
<main id="favorites-main-tv" style="margin-top: 75px; text-align: center"></main>

<div id="how-to-use">
    <button id="how-to-use-btn">How to Use</button>
</div>

<div id="how-to-use-section" style="display: none; text-align: center; padding: 20px; margin-top: 20px;">
    <h4 style="color: white">How to Use MovieVerse Watchlists</h4>
    <p>First, in order to create a watchlist, you must have at least one favorite movie or TV series. You can add movies and TV series to your favorites by clicking the heart icon on the movie or TV series details page.</p>
    <p>You can search for any movies or TV shows using the search bar at the top of the page. Once you have added some favorites, you can create a watchlist by clicking the "Create a Watch List" button.</p>
    <p>The list of movies and TV shows in the create watchlist form will be populated with your favorite movies and TV series. You can select the movies and TV series you want to include in your watchlist and give it a name and description.</p>
    <p>After creating a watchlist, you can edit or delete it by clicking the "Edit a Watch List" or "Delete Watch Lists" buttons respectively.</p>
    <p>Remember that when editing a watchlist, you must first select the watchlist you want to edit from the dropdown list. You can then change the name, description, and the movies and TV series included in the watchlist. The list of movies and TV shows will be populated with your favorite movies and TV series.</p>
    <p>Note that you can only delete watchlists that you have created. You can pin a watchlist to the top of the page by clicking the pin icon next to the watchlist name.</p>
    <p style="font-weight: bold; margin-top: 30px">Enjoy using MovieVerse Watchlists!</p>
</div>

<button id="settings-btn" style="position: fixed; bottom: 185px">Settings</button>
<button id="movie-match-btn" onclick="window.location.href='movie-match.html'" title="Find movies that match your mood and preferences!" style="bottom: 150px">Movie Match</button>
<button id="movie-timeline-btn" onclick="window.location.href='movie-timeline.html'" title="Explore movies through different eras!" style="bottom: 115px">Movie Timeline</button>
<button id="movie-of-the-day-btn" onclick="showMovieOfTheDay()" title="Get a recommended movie to watch for today!" style="bottom: 80px">Recommendation</button>
<button id="discussions-btn" onclick="window.location.href='chatbot.html'" style="bottom: 45px" title="Want to know more about movies? Chat with our intelligent chatbot!">MovieVerse Chatbot</button>
<button id="trivia-btn" onclick="window.location.href='trivia.html'" style="bottom: 10px" title="Play a quick trivia to test your knowledge about movies!">MovieVerse Trivia</button>

<script src="../js/movie-details.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        loadWatchLists();
        updateFavorites();
    });

    const tvCode = {
        part1: 'YzVhMjBjODY=',
        part2: 'MWFjZjdiYjg=',
        part3: 'ZDllOTg3ZGNjN2YxYjU1OA=='
    };

    function getMovieCode() {
        return atob(tvCode.part1) + atob(tvCode.part2) + atob(tvCode.part3);
    }

    function generateMovieNames(input) {
        return String.fromCharCode(97, 112, 105, 95, 107, 101, 121, 61);
    }

    document.getElementById('how-to-use-btn').addEventListener('click', function() {
        var howToUseSection = document.getElementById('how-to-use-section');
        if (howToUseSection.style.display === 'none') {
            howToUseSection.style.display = 'block';
            window.location.href = '#how-to-use-section';
            document.getElementById('how-to-use-btn').textContent = 'Hide Tutorial';
        }
        else {
            howToUseSection.style.display = 'none';
            document.getElementById('how-to-use-btn').textContent = 'How to Use';
        }
    });

    function updateFavorites() {
        const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        const favoriteTvSeries = JSON.parse(localStorage.getItem('favoritesTVSeries')) || [];
        const favoritesMain = document.getElementById('favorites-main');
        favoritesMain.style.textAlign = 'center';
        if (favorites.length === 0 && favoriteTvSeries.length === 0) {
            favoritesMain.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; text-align: center">\n' +
                '                <h2 style="color: white">No Favorite Movies & TV Series Added Yet.</h2>\n' +
                '            </div>`;';
        }
        else {
            if (favorites.length > 0) {
                favorites.forEach(movieId => fetchMovieDetails(movieId));
            }
            else {
                favoritesMain.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; text-align: center">\n' +
                    '                <h2 style="color: white">No Favorite Movies Added Yet.</h2>\n' +
                    '            </div>`;';
            }
            if (favoriteTvSeries.length > 0) {
                favoriteTvSeries.forEach(seriesId => fetchTVSeriesDetails(seriesId));
            }
            else {
                favoritesMain.style.marginTop = '0';
                document.getElementById('favorites-main-tv').innerHTML = '<div style="display: flex; justify-content: center; align-items: center; text-align: center">\n' +
                    '                <h2 style="color: white">No Favorite TV Series Added Yet.</h2>\n' +
                    '            </div>';
            }
        }
    }

    function rotateUserStats() {
        const stats = [
            {
                label: "Your Current Time",
                getValue: () => {
                    const now = new Date();
                    let hours = now.getHours();
                    let minutes = now.getMinutes();
                    hours = hours < 10 ? '0' + hours : hours;
                    minutes = minutes < 10 ? '0' + minutes : minutes;
                    return `${hours}:${minutes}`;
                }
            },
            { label: "Most Visited Movie", getValue: getMostVisitedMovie },
            { label: "Your Most Visited Director", getValue: getMostVisitedDirector },
            { label: "Your Most Visited Actor", getValue: getMostVisitedActor },
            {
                label: "Your Unique Movies Discovered",
                getValue: () => {
                    const viewedMovies = JSON.parse(localStorage.getItem('uniqueMoviesViewed')) || [];
                    return viewedMovies.length;
                }
            },
            {
                label: "Your Favorited Movies",
                getValue: () => {
                    const favoritedMovies = JSON.parse(localStorage.getItem('favorites')) || [];
                    return favoritedMovies.length;
                }
            },
            {
                label: "Your Most Common Favorited Genre",
                getValue: getMostCommonGenre
            },
            { label: "Your Created Watchlists", getValue: () => localStorage.getItem('watchlistsCreated') || 0 },
            { label: "Your Average Movie Rating", getValue: () => localStorage.getItem('averageMovieRating') || 'Not Rated' },
            {
                label: "Your Unique Directors Discovered",
                getValue: () => {
                    const viewedDirectors = JSON.parse(localStorage.getItem('uniqueDirectorsViewed')) || [];
                    return viewedDirectors.length;
                }
            },
            {
                label: "Your Unique Actors Discovered",
                getValue: () => {
                    const viewedActors = JSON.parse(localStorage.getItem('uniqueActorsViewed')) || [];
                    return viewedActors.length;
                }
            },
            {
                label: "Your Unique Production Companies Discovered",
                getValue: () => {
                    const viewedCompanies = JSON.parse(localStorage.getItem('uniqueCompaniesViewed')) || [];
                    return viewedCompanies.length;
                }
            },
            { label: "Your Trivia Accuracy", getValue: getTriviaAccuracy },
        ];

        let currentStatIndex = 0;

        function updateStatDisplay() {
            const currentStat = stats[currentStatIndex];
            document.getElementById('stats-label').textContent = currentStat.label + ':';
            document.getElementById('stats-display').textContent = currentStat.getValue();
            currentStatIndex = (currentStatIndex + 1) % stats.length;
        }

        updateStatDisplay();

        const localTimeDiv = document.getElementById('local-time');
        let statRotationInterval = setInterval(updateStatDisplay, 3000);

        localTimeDiv.addEventListener('click', () => {
            clearInterval(statRotationInterval);
            updateStatDisplay();
            statRotationInterval = setInterval(updateStatDisplay, 3000);
        });
    }

    function updateMovieVisitCount(movieId, movieTitle) {
        let movieVisits = JSON.parse(localStorage.getItem('movieVisits')) || {};
        if (!movieVisits[movieId]) {
            movieVisits[movieId] = { count: 0, title: movieTitle };
        }
        movieVisits[movieId].count += 1;
        localStorage.setItem('movieVisits', JSON.stringify(movieVisits));
    }

    function getMostVisitedMovie() {
        const movieVisits = JSON.parse(localStorage.getItem('movieVisits')) || {};
        let mostVisitedMovie = '';
        let maxVisits = 0;

        for (const movieId in movieVisits) {
            if (movieVisits[movieId].count > maxVisits) {
                mostVisitedMovie = movieVisits[movieId].title;
                maxVisits = movieVisits[movieId].count;
            }
        }

        return mostVisitedMovie || 'Not Available';
    }

    function getMostVisitedActor() {
        const actorVisits = JSON.parse(localStorage.getItem('actorVisits')) || {};
        let mostVisitedActor = '';
        let maxVisits = 0;

        for (const actorId in actorVisits) {
            if (actorVisits[actorId].count > maxVisits) {
                mostVisitedActor = actorVisits[actorId].name;
                maxVisits = actorVisits[actorId].count;
            }
        }

        return mostVisitedActor || 'Not Available';
    }

    function getMostVisitedDirector() {
        const directorVisits = JSON.parse(localStorage.getItem('directorVisits')) || {};
        let mostVisitedDirector = '';
        let maxVisits = 0;

        for (const directorId in directorVisits) {
            if (directorVisits[directorId].count > maxVisits) {
                mostVisitedDirector = directorVisits[directorId].name;
                maxVisits = directorVisits[directorId].count;
            }
        }

        return mostVisitedDirector || 'Not Available';
    }

    function getTriviaAccuracy() {
        let triviaStats = JSON.parse(localStorage.getItem('triviaStats')) || { totalCorrect: 0, totalAttempted: 0 };
        if (triviaStats.totalAttempted === 0) {
            return 'No trivia attempted';
        }
        let accuracy = (triviaStats.totalCorrect / triviaStats.totalAttempted) * 100;
        return `${accuracy.toFixed(1)}% accuracy`;
    }

    function getMostCommonGenre() {
        const favoriteGenres = JSON.parse(localStorage.getItem('favoriteGenres')) || {};
        let mostCommonGenre = '';
        let maxCount = 0;

        for (const genre in favoriteGenres) {
            if (favoriteGenres[genre] > maxCount) {
                mostCommonGenre = genre;
                maxCount = favoriteGenres[genre];
            }
        }

        return mostCommonGenre || 'Not Available';
    }

    document.addEventListener('DOMContentLoaded', rotateUserStats);

    function getMovieVerseData(input) {
        return String.fromCharCode(97, 112, 105, 46, 116, 104, 101, 109, 111, 118, 105, 101, 100, 98, 46, 111, 114, 103);
    }

    async function showMovieOfTheDay() {
        const year = new Date().getFullYear();
        const url = `https://${getMovieVerseData()}/3/discover/movie?${generateMovieNames()}${getMovieCode()}&sort_by=vote_average.desc&vote_count.gte=100&primary_release_year=${year}&vote_average.gte=7`;

        try {
            const response = await fetch(url);
            const data = await response.json();
            const movies = data.results;

            if (movies.length > 0) {
                const randomMovie = movies[Math.floor(Math.random() * movies.length)];
                localStorage.setItem('selectedMovieId', randomMovie.id);
                window.location.href = 'movie-details.html';
            }
            else {
                fallbackMovieSelection();
            }
        }
        catch (error) {
            console.error('Error fetching movie:', error);
            fallbackMovieSelection();
        }
    }

    function fallbackMovieSelection() {
        const fallbackMovies = [432413, 299534, 1726, 562, 118340, 455207, 493922, 447332, 22970, 530385, 27205, 264660, 120467, 603, 577922, 76341, 539, 419704, 515001, 118340, 424, 98];
        const randomFallbackMovie = fallbackMovies[Math.floor(Math.random() * fallbackMovies.length)];
        localStorage.setItem('selectedMovieId', randomFallbackMovie);
        window.location.href = 'movie-details.html';
    }

    function openModal(modalId) {
        document.getElementById(modalId).style.display = 'block';
    }

    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }

    document.getElementById('delete-watchlist-btn').addEventListener('click', () => openModal('delete-watchlist-modal'));

    async function getMovieTitle(movieId) {
        const apiKey = `${getMovieCode()}`;
        const url = `https://${getMovieVerseData()}/3/movie/${movieId}?${generateMovieNames()}${apiKey}`;

        try {
            const response = await fetch(url);
            const movie = await response.json();
            return movie.title;
        }
        catch (error) {
            console.error('Error fetching movie title:', error);
            return 'Unknown Movie';
        }
    }

    async function populateCreateModalWithFavorites() {
        const favoritesMovies = JSON.parse(localStorage.getItem('favorites')) || [];
        const favoritesTVSeries = JSON.parse(localStorage.getItem('favoritesTVSeries')) || [];
        const createForm = document.getElementById('create-watchlist-form');

        let container = document.getElementById('favorites-container');
        if (!container) {
            container = document.createElement('div');
            container.id = 'favorites-container';
            createForm.insertBefore(container, createForm.querySelector('button[type="submit"]'));
        }
        else {
            container.innerHTML = '';
        }

        let moviesLabel = document.createElement('label');
        moviesLabel.textContent = 'Select favorite movies to include in watchlist:';
        container.appendChild(moviesLabel);

        let moviesContainer = document.createElement('div');
        moviesContainer.id = 'movies-container';
        moviesContainer.style.marginTop = '-20px';
        container.appendChild(moviesContainer);

        if (favoritesMovies.length === 0) {
            moviesContainer.innerHTML = '<p style="margin-top: 20px">No Favorite Movies Added Yet.</p>';
        }
        else {
            for (const movieId of favoritesMovies) {
                const movieTitle = await getMovieTitle(movieId);
                appendCheckbox(moviesContainer, movieId, movieTitle, 'favoritedMovies');
            }
        }

        let tvSeriesLabel = document.createElement('label');
        tvSeriesLabel.textContent = 'Select favorite TV series to include in watchlist:';
        container.appendChild(tvSeriesLabel);

        let tvSeriesContainer = document.createElement('div');
        tvSeriesContainer.id = 'tvseries-container';
        tvSeriesContainer.style.marginTop = '-20px';
        container.appendChild(tvSeriesContainer);

        if (favoritesTVSeries.length === 0) {
            tvSeriesContainer.innerHTML = '<p style="margin-top: 20px">No Favorite TV Series Added Yet.</p>';
        }
        else {
            for (const seriesId of favoritesTVSeries) {
                const seriesTitle = await getTVSeriesTitle(seriesId);
                appendCheckbox(tvSeriesContainer, seriesId, seriesTitle, 'favoritedTVSeries');
            }
        }
    }

    document.getElementById('create-watchlist-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const name = document.getElementById('new-watchlist-name').value;
        const description = document.getElementById('new-watchlist-description').value;
        const selectedMovies = Array.from(document.querySelectorAll('#movies-container input[name="favoritedMovies"]:checked')).map(checkbox => checkbox.value);
        const selectedTVSeries = Array.from(document.querySelectorAll('#tvseries-container input[name="favoritedTVSeries"]:checked')).map(checkbox => checkbox.value);

        let watchlists = JSON.parse(localStorage.getItem('watchlists')) || [];
        const uniqueId = generateUniqueId();
        watchlists.push({
            id: uniqueId,
            name,
            description,
            movies: selectedMovies,
            tvSeries: selectedTVSeries,
            pinned: false,
            createdAt: new Date().toISOString()
        });

        localStorage.setItem('watchlists', JSON.stringify(watchlists));
        closeModal('create-watchlist-modal');
        updateWatchListsDisplay();
        window.location.reload();
    });

    async function getTVSeriesTitle(seriesId) {
        const apiKey = `${getMovieCode()}`;
        const url = `https://${getMovieVerseData()}/3/tv/${seriesId}?${generateMovieNames()}${apiKey}`;

        try {
            const response = await fetch(url);
            const series = await response.json();
            return series.name;
        }
        catch (error) {
            console.error('Error fetching TV series title:', error);
            return 'Unknown Series';
        }
    }

    function appendCheckbox(container, id, title, name) {
        const item = document.createElement('div');
        item.classList.add('favorite-item');
        item.style.display = 'flex';
        item.style.alignItems = 'center';

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.id = `${name}-${id}`;
        checkbox.value = id;
        checkbox.name = name;

        const label = document.createElement('label');
        label.htmlFor = `${name}-${id}`;
        label.textContent = title;
        label.style.marginTop = '12px';
        label.style.marginLeft = '10px';

        item.appendChild(checkbox);
        item.appendChild(label);
        container.appendChild(item);
    }


    document.getElementById('create-watchlist-btn').addEventListener('click', function() {
        document.getElementById('create-watchlist-form').reset();
        populateCreateModalWithFavorites();
        openModal('create-watchlist-modal');
        updateWatchlistsCreated();
    });

    function generateUniqueId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }

    document.getElementById('edit-watchlist-btn').addEventListener('click', async function() {
        await populateEditModal();
        openModal('edit-watchlist-modal');
    });

    async function populateEditModal() {
        const watchlists = JSON.parse(localStorage.getItem('watchlists')) || [];
        const favoritesMovies = JSON.parse(localStorage.getItem('favorites')) || [];
        const favoritesTVSeries = JSON.parse(localStorage.getItem('favoritesTVSeries')) || [];
        const editForm = document.getElementById('edit-watchlist-form');
        editForm.innerHTML = '';

        if (watchlists.length === 0) {
            const noWatchlistMsg = document.createElement('div');
            noWatchlistMsg.textContent = 'No Watchlists Available for Edit';
            noWatchlistMsg.style.textAlign = 'center';
            noWatchlistMsg.style.marginTop = '30px';
            noWatchlistMsg.style.color = 'white';
            editForm.appendChild(noWatchlistMsg);
            return;
        }

        const selectLabel = document.createElement('label');
        selectLabel.textContent = 'Select A Watch List:';
        selectLabel.setAttribute("for", "watchlist-select");
        editForm.appendChild(selectLabel);

        const select = document.createElement('select');
        select.id = 'watchlist-select';
        select.style.font = 'inherit';
        watchlists.forEach((watchlist, index) => {
            const option = document.createElement('option');
            option.value = index;
            option.textContent = watchlist.name;
            select.appendChild(option);
        });

        const nameLabel = document.createElement('label');
        nameLabel.textContent = 'Watch List Name:';
        const nameInput = document.createElement('input');
        nameInput.type = 'text';
        nameInput.id = 'edit-watchlist-name';
        nameInput.style.font = 'inherit';
        nameInput.placeholder = 'New Watchlist Name';

        const descLabel = document.createElement('label');
        descLabel.textContent = 'Description:';
        const descInput = document.createElement('textarea');
        descInput.id = 'edit-watchlist-description';
        descInput.style.font = 'inherit';
        descInput.placeholder = 'New Watchlist Description';

        const moviesContainer = document.createElement('div');
        moviesContainer.id = 'edit-movies-container';
        const moviesLabel = document.createElement('label');
        moviesLabel.textContent = 'Select favorite movies to include in watchlist:';
        editForm.appendChild(select);
        editForm.appendChild(nameLabel);
        editForm.appendChild(nameInput);
        editForm.appendChild(descLabel);
        editForm.appendChild(descInput);
        editForm.appendChild(moviesLabel);
        editForm.appendChild(moviesContainer);

        const tvSeriesContainer = document.createElement('div');
        tvSeriesContainer.id = 'edit-tvseries-container';
        const tvSeriesLabel = document.createElement('label');
        tvSeriesLabel.textContent = 'Select favorite TV series to include in watchlist:';
        tvSeriesLabel.style.marginTop = '20px';
        editForm.appendChild(tvSeriesLabel);
        editForm.appendChild(tvSeriesContainer);

        const updateForm = async (watchlist) => {
            nameInput.value = watchlist.name;
            descInput.value = watchlist.description;
            moviesContainer.innerHTML = '';
            tvSeriesContainer.innerHTML = '';

            if (!favoritesMovies || favoritesMovies.length === 0) {
                moviesContainer.innerHTML = '<p style="margin-top: 20px">No Favorite Movies Added Yet.</p>';
            }
            else {
                for (const movieId of favoritesMovies) {
                    const movieTitle = await getMovieTitle(movieId);
                    appendCheckbox(moviesContainer, movieId, movieTitle, 'favoritedMovies');
                }
            }

            if (!favoritesTVSeries || favoritesTVSeries.length === 0) {
                tvSeriesContainer.innerHTML = '<p style="margin-top: 20px">No Favorite TV Series Added Yet.</p>';
            }
            else {
                for (const seriesId of favoritesTVSeries) {
                    const seriesTitle = await getTVSeriesTitle(seriesId);
                    appendCheckbox(tvSeriesContainer, seriesId, seriesTitle, 'favoritedTVSeries');
                }
            }
        };

        select.addEventListener('change', function() {
            updateForm(watchlists[this.value]);
        });

        selectLabel.addEventListener('click', function() {
            updateForm(watchlists[select.value]);
        });

        if (watchlists.length > 0) {
            updateForm(watchlists[0]);
        }

        const submitButton = document.createElement('button');
        submitButton.type = 'submit';
        submitButton.textContent = 'Save Changes';
        editForm.appendChild(submitButton);

        const cancelButton = document.createElement('button');
        cancelButton.type = 'button';
        cancelButton.textContent = 'Cancel Changes';
        cancelButton.style.marginTop = '20px';
        cancelButton.onclick = () => closeModal('edit-watchlist-modal');
        editForm.appendChild(cancelButton);
    }

    document.getElementById('edit-watchlist-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const selectedIndex = document.getElementById('watchlist-select').value;
        const newName = document.getElementById('edit-watchlist-name').value;
        const newDescription = document.getElementById('edit-watchlist-description').value;
        const selectedMovies = Array.from(document.querySelectorAll('#edit-movies-container input[type="checkbox"]:checked')).map(checkbox => checkbox.value);

        let watchlists = JSON.parse(localStorage.getItem('watchlists')) || [];
        watchlists[selectedIndex] = {
            id: watchlists[selectedIndex].id,
            name: newName,
            description: newDescription,
            movies: selectedMovies,
            tvSeries: Array.from(document.querySelectorAll('#edit-tvseries-container input[type="checkbox"]:checked')).map(checkbox => checkbox.value),
            pinned: watchlists[selectedIndex].pinned
        };

        localStorage.setItem('watchlists', JSON.stringify(watchlists));
        closeModal('edit-watchlist-modal');
        window.location.reload();
    });

    function populateDeleteModal() {
        const watchlists = JSON.parse(localStorage.getItem('watchlists')) || [];
        const deleteForm = document.getElementById('delete-watchlist-form');
        deleteForm.innerHTML = '';

        if (watchlists.length === 0) {
            deleteForm.innerHTML = '<p style="margin-top: 20px">No Watchlists Available to Delete.</p>';
            return;
        }

        const checkboxesContainer = document.createElement('div');
        checkboxesContainer.id = 'delete-watchlist-checkboxes-container';

        watchlists.forEach((watchlist, index) => {
            appendCheckbox(checkboxesContainer, watchlist.id, watchlist.name, 'watchlistToDelete');
        });

        deleteForm.appendChild(checkboxesContainer);

        const deleteButton = document.createElement('button');
        deleteButton.type = 'button';
        deleteButton.textContent = 'Delete Selected';
        deleteButton.onclick = deleteSelectedWatchlists;
        deleteForm.appendChild(deleteButton);
    }

    async function deleteSelectedWatchlists() {
        const selectedCheckboxes = document.querySelectorAll('#delete-watchlist-checkboxes-container input[type="checkbox"]:checked');
        let watchlists = JSON.parse(localStorage.getItem('watchlists')) || [];

        const selectedIds = Array.from(selectedCheckboxes).map(checkbox => checkbox.value);
        watchlists = watchlists.filter(watchlist => !selectedIds.includes(watchlist.id));

        localStorage.setItem('watchlists', JSON.stringify(watchlists));

        closeModal('delete-watchlist-modal');
        updateWatchListsDisplay();
        window.location.reload();
    }

    document.getElementById('delete-watchlist-btn').addEventListener('click', populateDeleteModal);

    async function updateWatchListsDisplay() {
        const watchlists = JSON.parse(localStorage.getItem('watchlists')) || [];
        const displaySection = document.getElementById('watchlists-display-section');
        displaySection.innerHTML = '';

        if (watchlists.length === 0) {
            displaySection.innerHTML = '<p>No watch lists found. Start adding movies and TV series to your watchlists.</p>';
            return;
        }

        for (const watchlist of watchlists) {
            const watchlistDiv = document.createElement('div');
            watchlistDiv.className = 'watchlist';

            const title = document.createElement('h3');
            title.innerText = watchlist.name;

            const description = document.createElement('p');
            description.innerText = watchlist.description;

            watchlistDiv.appendChild(title);
            watchlistDiv.appendChild(description);

            if (watchlist.movies && watchlist.movies.length > 0) {
                const moviesContainer = document.createElement('div');
                for (const movieId of watchlist.movies) {
                    const movieCard = await fetchMovieDetails(movieId);
                    moviesContainer.appendChild(movieCard);
                }
                watchlistDiv.appendChild(moviesContainer);
            }

            if (watchlist.tvSeries && watchlist.tvSeries.length > 0) {
                const seriesContainer = document.createElement('div');
                for (const seriesId of watchlist.tvSeries) {
                    const seriesCard = await fetchTVSeriesDetails(seriesId);
                    seriesContainer.appendChild(seriesCard);
                }
                watchlistDiv.appendChild(seriesContainer);
            }

            displaySection.appendChild(watchlistDiv);
        }
    }

    async function fetchMovieDetails(movieId) {
        const code = `${getMovieCode()}`;
        const url = `https://${getMovieVerseData()}/3/movie/${movieId}?${generateMovieNames()}${code}&append_to_response=credits,keywords,similar`;

        try {
            const response = await fetch(url);
            const movie = await response.json();
            return createMovieCard(movie);
        }
        catch (error) {
            console.error('Error fetching movie details:', error);
            const errorDiv = document.createElement('div');
            errorDiv.textContent = 'Error loading movie card. Please try refreshing the page.';
            return errorDiv;
        }
    }

    function createMovieCard(movie) {
        const movieEl = document.createElement('div');
        movieEl.classList.add('movie');
        movieEl.style.cursor = 'pointer';

        movieEl.innerHTML = `
                <img src="${IMGPATH + movie.poster_path}" alt="${movie.title}" style="cursor: pointer">
                <div class="movie-info" style="cursor: pointer">
                    <h3>${movie.title}</h3>
                    <span class="${getClassByRate(movie.vote_average.toFixed(1))}">${movie.vote_average.toFixed(1)}</span>
                </div>
                <div class="overview">
                    <h4>Movie Overview:</h4>
                    ${movie.overview}
                </div>`;
        movieEl.addEventListener('click', () => {
            localStorage.setItem('selectedMovieId', movie.id);
            window.location.href = 'movie-details.html';
            updateMovieVisitCount(movie.id, movie.title);
        });

        return movieEl;
    }

    function getClassByRate(vote){
        if (vote >= 8) {
            return 'green';
        }
        else if (vote >= 5) {
            return 'orange';
        }
        else {
            return 'red';
        }
    }

    const searchForm = document.getElementById('form');

    searchForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const searchQuery = document.getElementById('search').value;
        localStorage.setItem('searchQuery', searchQuery);
        window.location.href = 'search.html';
    });

    function handleSearch() {
        const searchQuery = document.getElementById('search').value;
        localStorage.setItem('searchQuery', searchQuery);
        window.location.href = 'search.html';
    }

    async function getMovies(url) {
        const numberOfMovies = calculateMoviesToDisplay();
        const pagesToFetch = numberOfMovies <= 20 ? 1 : 2;
        let allMovies = [];

        for (let page = 1; page <= pagesToFetch; page++) {
            const response = await fetch(`${url}&page=${page}`);
            const data = await response.json();
            allMovies = allMovies.concat(data.results);
        }

        const popularityThreshold = 0.5;

        allMovies.sort((a, b) => {
            const popularityDifference = Math.abs(a.popularity - b.popularity);
            if (popularityDifference < popularityThreshold) {
                return b.vote_average - a.vote_average;
            }
            return b.popularity - a.popularity;
        });

        if (allMovies.length > 0) {
            showMovies(allMovies.slice(0, numberOfMovies));
        }
        else {
            searchResultsMain.innerHTML = `<p>No movie with the specified search term found. Please try again.</p>`;
        }
    }

    function showMovies(movies){
        searchResultsMain.innerHTML = '';
        movies.forEach((movie) => {
            const { id, poster_path, title, vote_average, overview } = movie;
            const movieE1 = document.createElement('div');
            const voteAverage = vote_average.toFixed(1);
            movieE1.classList.add('movie');

            const movieImage = poster_path
                ? `<img src="${IMGPATH + poster_path}" alt="${title}" style="cursor: pointer;" />`
                : `<div class="no-image" style="text-align: center; padding: 20px;">Image Not Available</div>`;

            movieE1.innerHTML = `
            ${movieImage}
            <div class="movie-info" style="cursor: pointer;">
                <h3>${title}</h3>
                <span class="${getClassByRate(vote_average)}">${voteAverage}</span>
            </div>
            <div class="overview" style="cursor: pointer;">
                <h4>Movie Overview: </h4>
                ${overview}
            </div>`;

            movieE1.addEventListener('click', () => {
                localStorage.setItem('selectedMovieId', id);
                window.location.href = 'movie-details.html';
                updateMovieVisitCount(id, title);
            });

            searchResultsMain.appendChild(movieE1);
        });
    }

    function calculateMoviesToDisplay() {
        const screenWidth = window.innerWidth;
        if (screenWidth <= 689.9) return 10;
        if (screenWidth <= 1021.24) return 20;
        if (screenWidth <= 1353.74) return 21;
        if (screenWidth <= 1684.9) return 20;
        if (screenWidth <= 2017.49) return 20;
        if (screenWidth <= 2349.99) return 18;
        if (screenWidth <= 2681.99) return 21;
        if (screenWidth <= 3014.49) return 24;
        if (screenWidth <= 3345.99) return 27;
        if (screenWidth <= 3677.99) return 20;
        if (screenWidth <= 4009.99) return 22;
        if (screenWidth <= 4340.99) return 24;
        if (screenWidth <= 4673.49) return 26;
        if (screenWidth <= 5005.99) return 28;
        if (screenWidth <= 5337.99) return 30;
        if (screenWidth <= 5669.99) return 32;
        if (screenWidth <= 6001.99) return 34;
        if (screenWidth <= 6333.99) return 36;
        if (screenWidth <= 6665.99) return 38;
        if (screenWidth <= 6997.99) return 40;
        if (screenWidth <= 7329.99) return 42;
        if (screenWidth <= 7661.99) return 44;
        if (screenWidth <= 7993.99) return 46;
        if (screenWidth <= 8325.99) return 48;
        return 20;
    }

    function handleSignInOut() {
        const isSignedIn = JSON.parse(localStorage.getItem('isSignedIn')) || false;

        if (isSignedIn) {
            localStorage.setItem('isSignedIn', JSON.stringify(false));
            alert('You have been signed out.');
        }
        else {
            window.location.href = 'sign-in.html';
            return;
        }

        updateSignInButtonState();
    }

    function updateSignInButtonState() {
        const isSignedIn = JSON.parse(localStorage.getItem('isSignedIn')) || false;

        const signInText = document.getElementById('signInOutText');
        const signInIcon = document.getElementById('signInIcon');
        const signOutIcon = document.getElementById('signOutIcon');

        if (isSignedIn) {
            signInText.textContent = 'Sign Out';
            signInIcon.style.display = 'none';
            signOutIcon.style.display = 'inline-block';
        }
        else {
            signInText.textContent = 'Sign In';
            signInIcon.style.display = 'inline-block';
            signOutIcon.style.display = 'none';
        }
    }

    document.addEventListener("DOMContentLoaded", function() {
        updateSignInButtonState();
        document.getElementById('googleSignInBtn').addEventListener('click', handleSignInOut);
    });

    async function loadWatchLists() {
        const watchlists = JSON.parse(localStorage.getItem('watchlists')) || [];
        const displaySection = document.getElementById('watchlists-display-section');

        if (watchlists.length === 0) {
            displaySection.innerHTML = '<p style="text-align: center">No watch lists found. Click on "Create a Watch List" to start adding movies.</p>';
        }
        else {
            watchlists.sort((a, b) => (b.pinned === a.pinned) ? 0 : b.pinned ? 1 : -1);

            for (const watchlist of watchlists) {
                const watchlistDiv = await createWatchListDiv(watchlist);
                if (watchlist.pinned) {
                    watchlistDiv.classList.add('pinned');
                }
                displaySection.appendChild(watchlistDiv);
            }
        }

        const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        if (favorites.length > 0) {
            const favoritesDiv = document.createElement('div');
            favoritesDiv.className = 'watchlist';
            favoritesDiv.id = 'favorites-watchlist';

            const title = document.createElement('h3');
            title.textContent = "Favorite Movies";
            title.className = 'watchlist-title';

            const description = document.createElement('p');
            description.textContent = "A collection of your favorite movies.";
            description.className = 'watchlist-description';

            favoritesDiv.appendChild(title);
            favoritesDiv.appendChild(description);

            const moviesContainer = document.createElement('div');
            moviesContainer.className = 'movies-container';

            for (const movieId of favorites) {
                const movieCard = await fetchMovieDetails(movieId);
                moviesContainer.appendChild(movieCard);
            }

            favoritesDiv.appendChild(moviesContainer);
            displaySection.appendChild(favoritesDiv);
        }
        else {
            const favoritesDiv = document.createElement('div');
            favoritesDiv.className = 'watchlist';
            favoritesDiv.id = 'favorites-watchlist';
            favoritesDiv.innerHTML = '<div style="text-align: center"><p style="text-align: center">No favorites added yet.</p></div>';

        }

        const favoritesTVSeries = JSON.parse(localStorage.getItem('favoritesTVSeries')) || [];
        if (favoritesTVSeries.length > 0) {
            const favoritesDiv = document.createElement('div');
            favoritesDiv.className = 'watchlist';
            favoritesDiv.id = 'favorites-watchlist';

            const title = document.createElement('h3');
            title.textContent = "Favorite TV Series";
            title.className = 'watchlist-title';

            const description = document.createElement('p');
            description.textContent = "A collection of your favorite TV series.";
            description.className = 'watchlist-description';

            favoritesDiv.appendChild(title);
            favoritesDiv.appendChild(description);

            const moviesContainer = document.createElement('div');
            moviesContainer.className = 'movies-container';

            for (const movieId of favoritesTVSeries) {
                const movieCard = await fetchTVSeriesDetails(movieId);
                moviesContainer.appendChild(movieCard);
            }

            favoritesDiv.appendChild(moviesContainer);
            displaySection.appendChild(favoritesDiv);
        }
        else {
            const favoritesDiv = document.createElement('div');
            favoritesDiv.className = 'watchlist';
            favoritesDiv.id = 'favorites-watchlist';
            favoritesDiv.innerHTML = '<div style="text-align: center"><p style="text-align: center">No favorites added yet.</p></div>';
        }
    }

    async function fetchTVSeriesDetails(tvSeriesId) {
        const code = `${getMovieCode()}`;
        const url = `https://${getMovieVerseData()}/3/tv/${tvSeriesId}?${generateMovieNames()}${code}&append_to_response=credits,keywords,similar`;

        try {
            const response = await fetch(url);
            const movie = await response.json();
            return createTVSeriesCard(movie);
        }
        catch (error) {
            const errorDiv = document.createElement('div');
            errorDiv.textContent = 'Error loading movie details. Please try refreshing the page.';
            return errorDiv;
        }
    }

    function createTVSeriesCard(movie) {
        const movieEl = document.createElement('div');
        movieEl.classList.add('movie');
        movieEl.style.cursor = 'pointer';

        movieEl.innerHTML = `
                <img src="${IMGPATH + movie.poster_path}" alt="${movie.title}" style="cursor: pointer">
                <div class="movie-info" style="cursor: pointer">
                    <h3>${movie.name}</h3>
                    <span class="${getClassByRate(movie.vote_average.toFixed(1))}">${movie.vote_average.toFixed(1)}</span>
                </div>
                <div class="overview">
                    <h4>Movie Overview:</h4>
                    ${movie.overview}
                </div>`;
        movieEl.addEventListener('click', () => {
            localStorage.setItem('selectedTvSeriesId', movie.id);
            window.location.href = 'tv-details.html';
            updateMovieVisitCount(movie.id, movie.title);
        });

        return movieEl;
    }

    function isListPinned(watchlistId) {
        const watchlists = JSON.parse(localStorage.getItem('watchlists')) || [];
        const watchlist = watchlists.find(watchlist => watchlist.id === watchlistId);
        return watchlist ? watchlist.pinned : false;
    }

    function addWatchListControls(watchlistDiv, watchlistId) {
        if (!watchlistId) {
            console.error('Missing watchlistId for', watchlistDiv);
            return;
        }

        const controlContainer = document.createElement('div');
        controlContainer.className = 'watchlist-controls';

        const pinBtn = document.createElement('button');
        pinBtn.innerHTML = '<i class="fas fa-thumbtack"></i>';
        pinBtn.onclick = function() { pinWatchList(watchlistDiv, watchlistId); };
        pinBtn.title = isListPinned(watchlistId) ? 'Unpin this watch list' : 'Pin this watch list';
        pinBtn.style.color = isListPinned(watchlistId) ? '#7378c5' : '#ff8623';

        const moveUpBtn = document.createElement('button');
        moveUpBtn.innerHTML = '<i class="fas fa-arrow-up"></i>';
        moveUpBtn.onclick = function() { moveWatchList(watchlistDiv, true); };

        const moveDownBtn = document.createElement('button');
        moveDownBtn.innerHTML = '<i class="fas fa-arrow-down"></i>';
        moveDownBtn.onclick = function() { moveWatchList(watchlistDiv, false); };

        controlContainer.appendChild(pinBtn);
        controlContainer.appendChild(moveUpBtn);
        controlContainer.appendChild(moveDownBtn);
        watchlistDiv.appendChild(controlContainer);
    }

    function createWatchListDiv(watchlist) {
        const watchlistDiv = document.createElement('div');
        watchlistDiv.className = 'watchlist';
        watchlistDiv.setAttribute('data-watchlist-id', watchlist.id);

        const title = document.createElement('h3');
        title.textContent = watchlist.name;
        title.className = 'watchlist-title';

        const description = document.createElement('p');
        description.textContent = watchlist.description;
        description.className = 'watchlist-description';

        watchlistDiv.appendChild(title);
        watchlistDiv.appendChild(description);

        const moviesContainer = document.createElement('div');
        moviesContainer.className = 'movies-container';
        moviesContainer.style.flexWrap = 'wrap';

        if (watchlist.movies === undefined) {
            moviesContainer.innerHTML = '';
        }
        else {
            watchlist.movies.forEach(movieId => {
                fetchMovieDetails(movieId).then(movieCard => moviesContainer.appendChild(movieCard));
            });
        }

        if (watchlist.tvSeries === undefined) {
            moviesContainer.innerHTML = '';
        }
        else {
            watchlist.tvSeries.forEach(tvSeriesId => {
                fetchTVSeriesDetails(tvSeriesId).then(tvSeriesCard => moviesContainer.appendChild(tvSeriesCard));
            });
        }

        watchlistDiv.appendChild(moviesContainer);
        addWatchListControls(watchlistDiv, watchlist.id);
        return watchlistDiv;
    }

    function updateWatchlistsOrderInLS() {
        const watchlistsDivs = document.querySelectorAll('#watchlists-display-section > .watchlist');
        let watchlists = JSON.parse(localStorage.getItem('watchlists')) || [];
        const newOrder = Array.from(watchlistsDivs).map(div => div.getAttribute('data-watchlist-id'));

        watchlists.sort((a, b) => newOrder.indexOf(a.id) - newOrder.indexOf(b.id));
        localStorage.setItem('watchlists', JSON.stringify(watchlists));
    }

    function moveWatchList(watchlistDiv, moveUp) {
        const sibling = moveUp ? watchlistDiv.previousElementSibling : watchlistDiv.nextElementSibling;
        if (sibling) {
            const parent = watchlistDiv.parentNode;
            if (moveUp) {
                parent.insertBefore(watchlistDiv, sibling);
            }
            else {
                parent.insertBefore(sibling, watchlistDiv);
            }
            updateWatchlistsOrderInLS();
            updateWatchListsDisplay();
        }
        window.location.reload();
    }

    function pinWatchList(watchlistDiv, watchlistId) {
        const isPinned = watchlistDiv.classList.contains('pinned');
        let watchlists = JSON.parse(localStorage.getItem('watchlists')) || [];

        watchlists.forEach(watchlist => {
            if (watchlist.id === watchlistId) {
                watchlist.pinned = !isPinned;
            }
        });

        watchlists.sort((a, b) => (b.pinned === a.pinned) ? 0 : b.pinned ? -1 : 1);

        localStorage.setItem('watchlists', JSON.stringify(watchlists));
        watchlistDiv.classList.toggle('pinned');
        loadWatchLists();
        window.location.reload();
    }

    document.getElementById('settings-btn').addEventListener('click', () => {
        window.location.href = 'settings.html';
    });

    document.addEventListener('DOMContentLoaded', () => {
        applySettings();

        function applySettings() {
            const savedBg = localStorage.getItem('backgroundImage');
            const savedTextColor = localStorage.getItem('textColor');
            const savedFontSize = localStorage.getItem('fontSize');

            if (savedBg) {
                document.body.style.backgroundImage = `url('${savedBg}')`;
            }
            if (savedTextColor) {
                document.querySelectorAll('h1, h2, h3, p, a, span, div, button, input, select, textarea, label, li').forEach(element => {
                    element.style.color = savedTextColor;
                });
            }
            if (savedFontSize) {
                const size = savedFontSize === 'small' ? '12px' : savedFontSize === 'medium' ? '16px' : '20px';
                document.body.style.fontSize = size;
            }
        }
    });

    function updateWatchlistsCreated() {
        let watchlistsCount = parseInt(localStorage.getItem('watchlistsCreated')) || 0;
        watchlistsCount++;
        localStorage.setItem('watchlistsCreated', watchlistsCount.toString());
    }
</script>

</body>

</html>